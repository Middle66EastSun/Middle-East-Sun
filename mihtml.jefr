<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم پیشرفته جفر - استخراج جواب دقیق</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 15px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
        }

        .question-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .question-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .method-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .method-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .method-card.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .results {
            margin-top: 30px;
        }

        .final-answer {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .analysis-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .analysis-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .calculation-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .letter-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 5px;
            margin-top: 15px;
        }

        .letter-value {
            background: #667eea;
            color: white;
            padding: 5px;
            border-radius: 5px;
            text-align: center;
            font-size: 12px;
        }

        .final-verdict {
            background: linear-gradient(45deg, #dc3545, #fd7e14);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        .confidence-bar {
            background: rgba(255, 255, 255, 0.3);
            height: 10px;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            transition: width 0.5s ease;
        }

        .interpretation-text {
            line-height: 1.8;
            margin-top: 15px;
        }

        .number-highlight {
            background: #ffc107;
            color: #212529;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔮 سیستم پیشرفته جفر</h1>
        
        <div class="input-section">
            <label for="questionInput" style="font-size: 1.2em; font-weight: bold; margin-bottom: 15px; display: block;">سوال خود را به طور کامل و دقیق بپرسید:</label>
            <textarea id="questionInput" class="question-input" placeholder="مثال: آیا ازدواج با این شخص برایم مناسب است؟ یا آیا باید شغل فعلی‌ام را تغییر دهم؟"></textarea>
            
            <div style="margin-top: 20px;">
                <label style="font-size: 1.1em; font-weight: bold; margin-bottom: 10px; display: block;">روش‌های تحلیل (چندین روش انتخاب کنید):</label>
                <div class="methods-grid">
                    <div class="method-card" data-method="traditional" onclick="toggleMethod(this)">
                        <div>🔢 روش سنتی</div>
                        <div style="font-size: 0.9em; margin-top: 5px;">ابجد کبیر</div>
                    </div>
                    <div class="method-card" data-method="zodiac" onclick="toggleMethod(this)">
                        <div>♈ روش بروج</div>
                        <div style="font-size: 0.9em; margin-top: 5px;">دوازده برج</div>
                    </div>
                    <div class="method-card" data-method="elements" onclick="toggleMethod(this)">
                        <div>🌟 روش عناصر</div>
                        <div style="font-size: 0.9em; margin-top: 5px;">آتش، آب، خاک، باد</div>
                    </div>
                    <div class="method-card" data-method="planets" onclick="toggleMethod(this)">
                        <div>🪐 روش سیارات</div>
                        <div style="font-size: 0.9em; margin-top: 5px;">هفت سیاره</div>
                    </div>
                    <div class="method-card" data-method="advanced" onclick="toggleMethod(this)">
                        <div>⚡ روش پیشرفته</div>
                        <div style="font-size: 0.9em; margin-top: 5px;">ترکیبی</div>
                    </div>
                </div>
            </div>
        </div>
        
        <button class="button" onclick="performAdvancedAnalysis()">🔍 تحلیل پیشرفته و استخراج جواب</button>
        
        <div id="results" class="results" style="display: none;">
            <div id="finalAnswer" class="final-answer"></div>
            <div id="analysisGrid" class="analysis-grid"></div>
            <div id="calculationDetails" class="calculation-details"></div>
            <div id="finalVerdict" class="final-verdict"></div>
        </div>
    </div>

    <script>
        let selectedMethods = [];

        const abjadTable = {
            'ا': 1, 'آ': 1, 'ب': 2, 'ج': 3, 'د': 4, 'ه': 5, 'و': 6, 'ز': 7, 'ح': 8, 'ط': 9,
            'ی': 10, 'ک': 20, 'ل': 30, 'م': 40, 'ن': 50, 'س': 60, 'ع': 70, 'ف': 80, 'ص': 90,
            'ق': 100, 'ر': 200, 'ش': 300, 'ت': 400, 'ث': 500, 'خ': 600, 'ذ': 700, 'ض': 800, 'ظ': 900, 'غ': 1000,
            'پ': 2, 'چ': 3, 'ژ': 7, 'گ': 20, 'ء': 1, 'ئ': 10, 'ة': 5
        };

        const zodiacSigns = ['حمل', 'ثور', 'جوزا', 'سرطان', 'اسد', 'سنبله', 'میزان', 'عقرب', 'قوس', 'جدی', 'دلو', 'حوت'];
        const elements = ['آتش', 'آب', 'خاک', 'باد'];
        const planets = ['خورشید', 'ماه', 'مریخ', 'عطارد', 'مشتری', 'زهره', 'زحل'];

        const interpretations = {
            traditional: {
                1: 'آغاز جدید، رهبری، استقلال - پاسخ مثبت',
                2: 'همکاری، صبر، دوگانگی - نیاز به تأمل',
                3: 'خلاقیت، ارتباط، شادی - پاسخ مثبت',
                4: 'ثبات، کار سخت، پایداری - پاسخ مثبت با تلاش',
                5: 'تغییر، آزادی، ماجراجویی - پاسخ مثبت',
                6: 'عشق، خانواده، مسئولیت - پاسخ مثبت',
                7: 'معنویت، تأمل، درونگرایی - نیاز به صبر',
                8: 'قدرت، موفقیت مادی، کنترل - پاسخ مثبت',
                9: 'کمال، خدمت، پایان - پاسخ مثبت با تکمیل'
            },
            zodiac: {
                'حمل': 'آتش، رهبری، شروع - اقدام کنید',
                'ثور': 'خاک، ثبات، صبر - منتظر بمانید',
                'جوزا': 'باد، ارتباط، تغییر - بررسی کنید',
                'سرطان': 'آب، احساس، خانواده - به قلبتان گوش دهید',
                'اسد': 'آتش، قدرت، خودباوری - جلو بروید',
                'سنبله': 'خاک، دقت، تحلیل - بررسی بیشتر',
                'میزان': 'باد، تعادل، عدالت - متعادل تصمیم بگیرید',
                'عقرب': 'آب، تحول، عمق - تغییر بزرگ در راه است',
                'قوس': 'آتش، آزادی، سفر - فرصت خوب',
                'جدی': 'خاک، جدیت، مسئولیت - با احتیاط',
                'دلو': 'باد، نوآوری، دوستی - راه جدید',
                'حوت': 'آب، روحانیت، شهود - به شهودتان اعتماد کنید'
            },
            elements: {
                'آتش': 'انرژی، اقدام، شور - زمان عمل است',
                'آب': 'احساس، شهود، انطباق - به احساستان گوش دهید',
                'خاک': 'ثبات، عملی، صبر - آرام و محکم',
                'باد': 'فکر، ارتباط، تغییر - بررسی و تحلیل'
            },
            planets: {
                'خورشید': 'قدرت، موفقیت، رهبری - بله قطعی',
                'ماه': 'احساس، تغییر، شهود - به شهودتان اعتماد کنید',
                'مریخ': 'جنگ، انرژی، اقدام - با قدرت جلو بروید',
                'عطارد': 'ارتباط، هوش، تجارت - بررسی کنید',
                'مشتری': 'خوشبختی، رشد، برکت - بله با برکت',
                'زهره': 'عشق، زیبایی، هنر - پاسخ مثبت در عشق',
                'زحل': 'محدودیت، درس، صبر - صبر کنید'
            }
        };

        function toggleMethod(element) {
            const method = element.getAttribute('data-method');
            const index = selectedMethods.indexOf(method);
            
            if (index === -1) {
                selectedMethods.push(method);
                element.classList.add('active');
            } else {
                selectedMethods.splice(index, 1);
                element.classList.remove('active');
            }
        }

        function calculateJafr(text) {
            let totalValue = 0;
            let letterValues = [];
            const cleanText = text.replace(/[؟،؛:.!?\s]/g, '');
            
            for (let char of cleanText) {
                const value = abjadTable[char] || 0;
                if (value > 0) {
                    totalValue += value;
                    letterValues.push({ char, value });
                }
            }

            return {
                totalValue,
                reducedValue: reduceToSingleDigit(totalValue),
                letterCount: letterValues.length,
                letterValues,
                cleanText,
                modValues: {
                    mod2: totalValue % 2,
                    mod3: totalValue % 3,
                    mod4: totalValue % 4,
                    mod7: totalValue % 7,
                    mod12: totalValue % 12
                }
            };
        }

        function reduceToSingleDigit(num) {
            while (num > 9) {
                let sum = 0;
                while (num > 0) {
                    sum += num % 10;
                    num = Math.floor(num / 10);
                }
                num = sum;
            }
            return num;
        }

        function getTraditionalInterpretation(jafr) {
            const reduced = jafr.reducedValue;
            return {
                title: 'تفسیر سنتی (ابجد)',
                content: interpretations.traditional[reduced] || 'نیاز به تأمل بیشتر',
                confidence: 85
            };
        }

        function getZodiacInterpretation(jafr) {
            const zodiacIndex = jafr.modValues.mod12;
            const sign = zodiacSigns[zodiacIndex];
            return {
                title: 'تفسیر بروج',
                content: `برج ${sign}: ${interpretations.zodiac[sign]}`,
                confidence: 80
            };
        }

        function getElementInterpretation(jafr) {
            const elementIndex = jafr.modValues.mod4;
            const element = elements[elementIndex];
            return {
                title: 'تفسیر عناصر',
                content: `عنصر ${element}: ${interpretations.elements[element]}`,
                confidence: 75
            };
        }

        function getPlanetInterpretation(jafr) {
            const planetIndex = jafr.modValues.mod7;
            const planet = planets[planetIndex];
            return {
                title: 'تفسیر سیارات',
                content: `سیاره ${planet}: ${interpretations.planets[planet]}`,
                confidence: 85
            };
        }

        function getAdvancedInterpretation(jafr) {
            const isPositive = jafr.modValues.mod2 === 1;
            const strength = jafr.modValues.mod3;
            const timing = jafr.modValues.mod4;
            
            let interpretation = '';
            if (isPositive) {
                interpretation += 'انرژی مثبت قوی. ';
            } else {
                interpretation += 'نیاز به احتیاط. ';
            }
            
            if (strength === 0) {
                interpretation += 'قدرت کامل. ';
            } else if (strength === 1) {
                interpretation += 'قدرت متوسط. ';
            } else {
                interpretation += 'نیاز به تقویت. ';
            }
            
            if (timing === 0) {
                interpretation += 'زمان مناسب برای اقدام.';
            } else if (timing === 1) {
                interpretation += 'کمی صبر کنید.';
            } else {
                interpretation += 'زمان‌بندی مهم است.';
            }
            
            return {
                title: 'تحلیل پیشرفته',
                content: interpretation,
                confidence: 90
            };
        }

        function getFinalVerdict(analyses) {
            let positiveCount = 0;
            let negativeCount = 0;
            let neutralCount = 0;
            
            analyses.forEach(analysis => {
                const content = analysis.content.toLowerCase();
                if (content.includes('مثبت') || content.includes('بله') || content.includes('اقدام') || content.includes('جلو')) {
                    positiveCount++;
                } else if (content.includes('منفی') || content.includes('خیر') || content.includes('احتیاط') || content.includes('صبر')) {
                    negativeCount++;
                } else {
                    neutralCount++;
                }
            });
            
            let verdict = '';
            let confidence = 0;
            
            if (positiveCount > negativeCount) {
                verdict = '✅ پاسخ مثبت - پیش بروید';
                confidence = Math.min(95, 60 + (positiveCount * 10));
            } else if (negativeCount > positiveCount) {
                verdict = '❌ پاسخ منفی - احتیاط کنید';
                confidence = Math.min(95, 60 + (negativeCount * 10));
            } else {
                verdict = '⚖️ متعادل - بررسی بیشتر لازم است';
                confidence = 70;
            }
            
            return { verdict, confidence };
        }

        function performAdvancedAnalysis() {
            const question = document.getElementById('questionInput').value.trim();
            
            if (!question) {
                alert('لطفاً سوال خود را وارد کنید');
                return;
            }

            if (selectedMethods.length === 0) {
                alert('لطفاً حداقل یک روش تحلیل انتخاب کنید');
                return;
            }

            const jafr = calculateJafr(question);
            const analyses = [];
            
            // انجام تحلیل‌ها بر اساس روش‌های انتخاب شده
            if (selectedMethods.includes('traditional')) {
                analyses.push(getTraditionalInterpretation(jafr));
            }
            if (selectedMethods.includes('zodiac')) {
                analyses.push(getZodiacInterpretation(jafr));
            }
            if (selectedMethods.includes('elements')) {
                analyses.push(getElementInterpretation(jafr));
            }
            if (selectedMethods.includes('planets')) {
                analyses.push(getPlanetInterpretation(jafr));
            }
            if (selectedMethods.includes('advanced')) {
                analyses.push(getAdvancedInterpretation(jafr));
            }
            
            const finalResult = getFinalVerdict(analyses);
            
            // نمایش نتایج
            document.getElementById('results').style.display = 'block';
            
            // پاسخ نهایی
            document.getElementById('finalAnswer').innerHTML = `
                <div style="font-size: 24px; margin-bottom: 15px;">📊 نتیجه تحلیل جفر</div>
                <div style="font-size: 18px; margin-bottom: 10px;">سوال: ${question}</div>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: ${finalResult.confidence}%"></div>
                </div>
                <div style="margin-top: 15px;">اطمینان: ${finalResult.confidence}٪</div>
                <div style="margin-top: 10px;">روش‌های تحلیل: ${selectedMethods.length} روش</div>
            `;
            
            // کارت‌های تحلیل
            let analysisHTML = '';
            analyses.forEach(analysis => {
                analysisHTML += `
                    <div class="analysis-card">
                        <h3>${analysis.title}</h3>
                        <div class="interpretation-text">${analysis.content}</div>
                        <div class="confidence-bar" style="margin-top: 10px;">
                            <div class="confidence-fill" style="width: ${analysis.confidence}%"></div>
                        </div>
                        <div style="margin-top: 5px; font-size: 14px;">اطمینان: ${analysis.confidence}٪</div>
                    </div>
                `;
            });
            document.getElementById('analysisGrid').innerHTML = analysisHTML;
            
            // جزئیات محاسبات
            let letterBreakdown = '';
            jafr.letterValues.forEach(item => {
                letterBreakdown += `<div class="letter-value">${item.char}<br>${item.value}</div>`;
            });
            
            document.getElementById('calculationDetails').innerHTML = `
                <h3>📊 جزئیات محاسبات</h3>
                <div style="margin-bottom: 15px;">
                    <strong>متن پاک شده:</strong> ${jafr.cleanText}<br>
                    <strong>تعداد حروف:</strong> ${jafr.letterCount}<br>
                    <strong>مجموع کل:</strong> <span class="number-highlight">${jafr.totalValue}</span><br>
                    <strong>عدد کاهش یافته:</strong> <span class="number-highlight">${jafr.reducedValue}</span>
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>تجزیه حروف:</strong>
                    <div class="letter-breakdown">${letterBreakdown}</div>
                </div>
            `;
            
            // حکم نهایی
            document.getElementById('finalVerdict').innerHTML = `
                <div style="font-size: 24px; margin-bottom: 15px;">⚖️ حکم نهایی</div>
                <div style="font-size: 20px; margin-bottom: 15px;">${finalResult.verdict}</div>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: ${finalResult.confidence}%"></div>
                </div>
                <div style="margin-top: 15px;">درجه اطمینان: ${finalResult.confidence}٪</div>
                <div style="margin-top: 20px; font-size: 16px; line-height: 1.6;">
                    <strong>توصیه:</strong> این تحلیل بر اساس علم جفر سنتی انجام شده است. 
                    همیشه از عقل و منطق خود نیز استفاده کنید و در تصمیمات مهم با افراد مطلع مشورت کنید.
                </div>
            `;
        }
    </script>
</body>
</html>
